<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mother of Pearl Generator</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      background: #111;
      color: #fff;
      font-family: sans-serif;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: 0 auto;
    }
    #controls {
      position: fixed;
      top: 10px; left: 10px;
      background: rgba(0,0,0,0.6);
      padding: 1rem;
      border-radius: 8px;
      z-index: 10;
    }
    label {
      display: block;
      margin-bottom: 0.3rem;
    }
    input[type="range"] {
      width: 150px;
    }
    button {
      margin-top: 0.5rem;
      padding: 4px 10px;
    }
  </style>
</head>
<body>

<div id="controls">
  <label>Light Angle: <input type="range" id="lightAngle" min="0" max="1" step="0.01" value="0.5"></label>
  <label>Noise Scale: <input type="range" id="scale" min="0.001" max="0.02" step="0.001" value="0.006"></label>
  <label>Color Blend: <input type="range" id="blend" min="0.5" max="3" step="0.1" value="1.2"></label>
  <button onclick="generate()">Generate</button>
  <button onclick="exportPNG()">Export PNG</button>
</div>

<canvas id="canvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/simplex-noise@2.4.0/simplex-noise.min.js"></script>
<script>
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  let width = canvas.width = window.innerWidth;
  let height = canvas.height = window.innerHeight;

  const simplex = new SimplexNoise();

  const palette = [
    { h: 290, s: 20, l: 85 }, // lavender
    { h: 180, s: 20, l: 85 }, // pale teal
    { h: 60,  s: 20, l: 90 }, // soft yellow
    { h: 330, s: 20, l: 88 }, // rose
    { h: 0,   s: 0,  l: 95 }  // pearl white
  ];

  function blendPalette(value, sharpness = 1.2) {
    const scaled = value * (palette.length - 1);
    const index = Math.floor(scaled);
    const frac = (scaled - index) ** sharpness;

    const c1 = palette[index % palette.length];
    const c2 = palette[(index + 1) % palette.length];

    const h = c1.h + (c2.h - c1.h) * frac;
    const s = c1.s + (c2.s - c1.s) * frac;
    const l = c1.l + (c2.l - c1.l) * frac;

    return `hsl(${h}, ${s}%, ${l}%)`;
  }

  function generate() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;

    const lightAngle = parseFloat(document.getElementById("lightAngle").value);
    const scale = parseFloat(document.getElementById("scale").value);
    const blendSharpness = parseFloat(document.getElementById("blend").value);

    const lightVec = {
      x: Math.cos(lightAngle * 2 * Math.PI),
      y: Math.sin(lightAngle * 2 * Math.PI)
    };

    const imgData = ctx.createImageData(width, height);
    const data = imgData.data;

    for (let y = 0; y < height; y++) {
      for (let x = 0; x < width; x++) {
        const nx = x / width - 0.5;
        const ny = y / height - 0.5;

        const angleInfluence = nx * lightVec.x + ny * lightVec.y;
        const n = simplex.noise2D(x * scale, y * scale);
        const value = (n + angleInfluence * 1.5 + 1) / 2; // normalize to [0,1]

        const color = blendPalette(value, blendSharpness);
        ctx.fillStyle = color;
        ctx.fillRect(x, y, 1, 1);
      }
    }
  }

  function exportPNG() {
    const link = document.createElement("a");
    link.download = "mother_of_pearl.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  }

  generate();
</script>
</body>
</html>
